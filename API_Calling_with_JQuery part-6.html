<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Calling part-6</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Spinner tag start -->
    <div class="d-flex justify-content-center a_myloader invisible">
      <div class="spinner-border" role="status">
        <span class="visually-hidden"> Loading.... </span>
      </div>
    </div>
    <!-- Spinner tag end -->

    <!-- Modal section start -->
    <!-- Button trigger modal -->

    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body a_model-body">
            <ul class="list-group">
              <li class="list-group-item"></li>
              <li class="list-group-item">A second item</li>
              <li class="list-group-item">A third item</li>
            </ul>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modale section end -->
    <script>
      //DRY => don't repeat yourself
      var loader = document.querySelector(".a_myloader");
      $.ajax({
        url: "https://fakerestapi.azurewebsites.net/api/v1/CoverPhotos",
        type: "GET",
        beforeSend: function (xhr) {
          loader.classList.remove("invisible");
        },
        success: function (result, status, xhr) {
          //Success data
          //loader.classList.add("invisible");
          console.log(result);
          var tr = `<table class="table">
      <thead>
        <tr>
          <th scope="col">id</th>
          <th scope="col">idBook</th>
          <th scope="col">url</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>`;
          result.forEach((element) => {
            console.log(element);
            tr =
              tr +
              `<tr>
          <td scope="row">` +
              element.id +
              `</td>
          <td>` +
              element.idBook +
              `</td>
          <td><a href="` +
              element.url +
              `" target="_blank">Link</a></td>


          <td>
            <button class="btn btn-sm btn-success" data-bs-toggle="modal"
      data-bs-target="#exampleModal" a_myviewbtn >View</button>
            <button class="btn btn-sm btn-info" >Edit</button>
            <button class="btn btn-sm btn-danger" btn-success" data-bs-toggle="modal"
      data-bs-target="#exampleModal">Delete</button>
          </td>
        </tr>`;
          });
          tr =
            tr +
            `</tbody>
              </table>`;
          document.body.innerHTML = document.body.innerHTML + tr;
          console.log(tr);
        },
        error: function (xhr, status, error) {
          //Error
        },
        complete: function () {
          loader.classList.remove("invisible");
        },
      });
      /*   */
      //document=whole webpage

      document.addEventListener("click", function (e) {
        /* alert("ok"); */
        //console.log("ok");
        if (e.target.classList.contains("a_myviewbtn")) {
          console.log("yes");
          let id = e.target
            .closest("tr")
            .querySelector("td:first-child").innerHTML;
          let idBook = e.target
            .closest("tr")
            .querySelector("td:nth-child(2)").innerHTML;
          console.log(
            e.target
              .closest("tr")
              .querySelector("td:nth-child(3) > a")
              .getAttribute("href")
          );
          let link = e.target
            .closest("tr")
            .querySelector("td:nth-child(3) > a")
            .getAttribute("href");

          /* Model list section start*/
          let lg = document.querySelector(".a_model-body > .list-group");
          lg.querySelector("li:first-child").innerHTML = id;
          lg.querySelector("li:nth-child(2)").innerHTML = idBook;
          lg.querySelector("li:last-child").innerHTML = link;
          /* Model list section end */
          console.log(
            e.target
              .closest("tr")
              .querySelector("td:nth-child(3) > a")
              .getAttribute("href")
          );
          console.log(
            e.target.closest("tr").querySelector("td:nth-child(2)").innerHTML
          );
          console.log(
            e.target.closest("tr").querySelector("td:first-child").innerHTML
          );
        }
      });

      //second if case
      if (e.tartget.classList.container("a_mydelbtn")) {
        console.log("yes");
        //1.Call the delete api
        //2.Remove the current row
        var tr = e.target.closest("tr");
        var delid = tr.querySelector("td:first-child").innerHTML;
        $.ajax({
          url:
            "https://fakerestapi.azurewebsites.net/api/v1/CoverPhotos/" + delid,
          type: "DELETE",
          beforeSend: function () {},
          success: function (result, status, xhr) {
            tr.remove();
            alert("cover photo delete success");
          },
          error: function () {},
          complete: function () {},
        });
      }

      /*  else {
          console.log("No");
        } */
    </script>
  </body>
</html>
